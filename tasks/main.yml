---
- name: include variable overrides
  include_vars: "{{ item }}"
  with_first_found:
    - files:
        - "vars/{{ ansible_distribution }}-{{ ansible_distribution_major_version }}.yml"
        - "vars/{{ ansible_distribution }}.yml"
        - "vars/{{ ansible_os_family }}.yml"
      skip: true

- name: install packages
  package:
    name: "{{ git_packages }}"
    state: "{{ git_packages_state }}"
  become: yes

- name: Execute lfs auto install command
  shell: |
    curl -s {{ git_lfs_install_url }} | bash
  when: git_lfs_install_url is defined
  changed_when: false
  tags:
    - skip_ansible_lint

- name: Install git-lfs package
  package: |
    name: {{ git_packages_lfs }}
    state: {{ git_packages_state }}
  when: git_packages_lfs is defined

- name: Initialize git-lfs
  shell: git lfs install
  when: git_packages_lfs is defined
  changed_when: false
  tags:
    - skip_ansible_lint

- name: set up git prompt
  copy:
    dest: "~/{{ git_prompt_path }}"
    src: "{{ git_prompt_template }}"
  no_log: yes

- name: configure git prompt
  lineinfile:
    dest: "~/{{ bash_configuration_file }}"
    line: '[[ -f ~/{{ git_prompt_path }} ]] && source ~/{{ git_prompt_path }}'
    create: yes

- name: set up git completion
  copy:
    dest: "~/{{ git_completion_path }}"
    src: "{{ git_completion_template }}"
  no_log: yes

- name: configure git completion
  lineinfile:
    dest: "~/{{ bash_configuration_file }}"
    line: '[[ -f ~/{{ git_completion_path }} ]] && source ~/{{ git_completion_path }}'
    create: yes
